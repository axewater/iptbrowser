<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Manager - IPTorrents Browser</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cookie_manager.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-top">
                <a href="/" class="btn btn-back">‚Üê Back to Browser</a>
                <div class="header-title">
                    <h1>Cookie Manager</h1>
                    <p class="subtitle">Manage IPTorrents authentication cookies</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <div class="cookie-manager-content">

            <!-- Cookie Status Card -->
            <section class="card">
                <h2>Current Cookie Status</h2>
                <div id="cookie-status" class="status-container">
                    <div class="loading">Loading status...</div>
                </div>
            </section>

            <!-- View/Edit Cookie Card -->
            <section class="card">
                <h2>Cookie Value</h2>
                <div class="cookie-display">
                    <div class="form-group">
                        <label for="cookie-value">Cookie:</label>
                        <div class="cookie-input-container">
                            <textarea
                                id="cookie-value"
                                class="input-field cookie-textarea"
                                rows="3"
                                readonly
                                placeholder="No cookie configured"
                            ></textarea>
                            <button id="toggle-mask-btn" class="btn btn-icon" title="Show/Hide">
                                <span class="icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div class="button-group">
                        <button id="edit-cookie-btn" class="btn btn-secondary">Edit Cookie</button>
                        <button id="save-cookie-btn" class="btn btn-primary" style="display: none;">Save Changes</button>
                        <button id="cancel-edit-btn" class="btn btn-secondary" style="display: none;">Cancel</button>
                    </div>
                </div>
            </section>

            <!-- Test Cookie Card -->
            <section class="card">
                <h2>Cookie Validation</h2>
                <div class="validation-section">
                    <p>Test your cookie to ensure it's valid and working correctly.</p>
                    <button id="test-cookie-btn" class="btn btn-primary">
                        <span class="btn-text">Test Cookie</span>
                        <span class="btn-loading" style="display: none;">Testing...</span>
                    </button>
                    <div id="test-result" class="test-result" style="display: none;">
                        <!-- Test results populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- Extract from Browser Card -->
            <section class="card">
                <h2>Extract from Browser</h2>
                <div class="extract-section">
                    <p>Automatically extract your IPTorrents cookie from a local browser.</p>

                    <div class="form-group">
                        <label for="browser-select">Browser:</label>
                        <select id="browser-select" class="input-field">
                            <option value="">-- Detecting browsers... --</option>
                        </select>
                    </div>

                    <button id="extract-cookie-btn" class="btn btn-primary" disabled>
                        <span class="btn-text">Extract Cookie</span>
                        <span class="btn-loading" style="display: none;">Extracting...</span>
                    </button>

                    <div id="extract-result" class="extract-result" style="display: none;">
                        <!-- Extraction results populated by JavaScript -->
                    </div>

                    <div class="info-box">
                        <h4>How it works:</h4>
                        <ul>
                            <li><strong>Chrome/Edge:</strong> Reads encrypted cookies from browser database using Windows DPAPI</li>
                            <li><strong>Firefox:</strong> Reads cookies directly from browser database</li>
                            <li>Close your browser for best results (to avoid database locks)</li>
                            <li>Only reads cookies for iptorrents.com domain</li>
                            <li>Requires you to be logged into IPTorrents in the selected browser</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Manual Cookie Instructions -->
            <section class="card">
                <h2>Manual Cookie Extraction</h2>
                <div class="manual-instructions">
                    <p>If automatic extraction doesn't work, you can manually copy your cookie:</p>
                    <ol>
                        <li>Open your browser and navigate to <a href="https://iptorrents.com" target="_blank" rel="noopener">iptorrents.com</a></li>
                        <li>Press <kbd>F12</kbd> to open Developer Tools</li>
                        <li>Go to <strong>Application</strong> tab (Chrome) or <strong>Storage</strong> tab (Firefox)</li>
                        <li>Navigate to <strong>Cookies</strong> ‚Üí <strong>https://iptorrents.com</strong> or <strong>http://www.iptorrents.com</strong></li>
                        <li>Find the <code>uid</code> and <code>pass</code> cookies</li>
                        <li>Copy their values and format as: <code>uid=VALUE; pass=VALUE</code></li>
                        <li>Paste into the Cookie Value field above and click Save Changes</li>
                    </ol>
                    <div class="example-box">
                        <strong>Example format:</strong><br>
                        <code>uid=451419; pass=ee512bb151e63b20e8debc35efdf7493</code>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="{{ url_for('static', filename='js/cookie_manager.js') }}"></script>
</body>
</html>
